=== Glass Unit ===
id: services.transcription
version: 0.2.0
language: typescript

=== Intent ===
purpose: Convert audio and video files to text using Cloudflare Workers AI Whisper model (whisper-large-v3-turbo). Supports initial_prompt with user's personal dictionary for proper noun accuracy. Transcripts are used as raw content for journal entries, then passed to AI polish.
source:
  kind: prd
  reference: "PRD Section 8.2 — Audio/Video Transcription"
parent: null
stakeholder: user
subIntents: []
approvalStatus: approved

=== Contract ===
requires:
  - "AI binding (Workers AI) is available in the Worker environment"
  - "Audio source is valid audio data as ArrayBuffer"
guarantees:
  on_success:
    - "transcribeAudio returns transcript text from whisper-large-v3-turbo model"
    - "Accepts optional initial_prompt for vocabulary context (proper nouns)"
    - "Word count and estimated duration are tracked"
    - "transcribeFromR2 fetches audio from R2 and transcribes it"
    - "Processing is logged to D1 processing_log table"
  on_failure:
    - "R2 fetch failures are logged with the R2 key"
    - "All failures are logged to processing_log"
invariants:
  - "Every transcription attempt is logged (success or failure)"
  - "R2 objects are read but never modified by this service"
fails:
  R2ObjectNotFound: "Log failure, throw with R2 key context"
  EmptyTranscript: "Throw error when no transcript returned from Whisper"
advisories:
  - "Workers AI Whisper is included in Workers Paid plan — no per-request cost"
  - "Whisper does not return confidence scores — set to 1.0 for interface compatibility"
